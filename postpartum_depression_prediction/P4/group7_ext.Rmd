---
title: "group7_extension.Rmd"
author: "Nathaniel Evans, ALfonso Poire, Wei-Chun Lin"
date: "November 25, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(tidyr)
library(ggplot2)
library(GGally)
library(DescTools)
```


## Load Tidy Dataset 

```{r}
getwd()

load('../../data/tidy_data.Rdata')

pp_sad <- df_tidy # rename meaningful 

pp_sad <- pp_sad %>% mutate(postpartum_depression=postpartum_depression-1)
``` 



## Future Extension ... (I got bored)
This isn't really EDA, more of extension, but... I wonder if AUC of the cortisol points would be a better predictor of pp depression than just the point values. Would require fitting a curve, calculating the integral.... ORRRR could we use a curve to predict cortisol levels during pp? then use THAT metric to predict depression. 

$$ AUC = \int_{0}^{6} (\beta x + C) \space dx \\ ==> 18B + 6C $$
## Calculating the AUC by linear interpolation and then using a probit fit to predict dichotomous postpartum depression. 


```{r}
AUC <- vector(mode = 'numeric', length=44)
for (i in seq(1,44,1)){ 
  patient <- pp_sad %>% filter(row_number() == i)
  
  y <- c(patient$cortisol_tri1, patient$cortisol_tri2, patient$cortisol_tri3)
  x <- c(2, 5, 8) #months, what are the actual time frames we should use?
  
  AUC[i] <- AUC(x, y, method = "trapezoid", na.rm = FALSE) # this uses interpolation between our data points instead of lm fit
}

pp_sad <- pp_sad %>% mutate(Cortisol_AUC = AUC)

pp_sad %>% ggplot(aes(x=Cortisol_AUC, y=postpartum_depression)) + geom_point() + geom_smooth(method='glm', method.args=list(family=binomial(link="probit")))

pp_sad %>% ggplot(aes(x=Cortisol_AUC, group=postpartum_depression, fill=as.factor(postpartum_depression), alpha=0.25)) + geom_density()

```

```{r} 
pp_probit <- glm('postpartum_depression ~ Cortisol_AUC', family = binomial(link = 'probit'), data = pp_sad)

#pp_sad <- pp_sad %>% mutate(postpartum_depression = ifelse(postpartum_depression == "1", 'True', 'False'))

#t.test('Cortisol_AUC ~ postpartum_depression', data=pp_sad, alternative = 'two.sided', na.rm=TRUE) # this is not working... 

summary(pp_probit)

'------------------------------------------------'

aov <- anova(pp_probit)
aov

```
