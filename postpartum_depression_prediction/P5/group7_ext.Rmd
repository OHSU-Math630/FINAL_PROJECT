---
title: "group7_extension.Rmd"
author: "Nathaniel Evans, ALfonso Poire, Wei-Chun Lin"
date: "November 25, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(tidyr)
library(ggplot2)
library(GGally)
```


## Load Tidy Dataset 

```{r}
getwd()

load('../../data/tidy_data.Rdata')

pp_sad <- df_tidy # rename meaningful 

pp_sad <- pp_sad %>% mutate(postpartum_depression=postpartum_depression-1)
``` 



## Future Extension ... (I got bored)
This isn't really EDA, more of extension, but... I wonder if AUC of the cortisol points would be a better predictor of pp depression than just the point values. Would require fitting a curve, calculating the integral.... ORRRR could we use a curve to predict cortisol levels during pp? then use THAT metric to predict depression. 

$$ auc = \int_{0}^{6} (\beta x + C) \space dx \\ ==> 18B + 6C $$
## This is actually really interesting, fitting the curves linear gives a signficant population divergence, but fitting with a polynomial has almost no pop. divergence


```{r}
AUC <- vector(mode = 'numeric', length=44)
for (i in seq(1,44,1)){ 
  patient <- pp_sad %>% filter(row_number() == i)
  
  y <- c(patient$cortisol_tri1, patient$cortisol_tri2, patient$cortisol_tri3)
  x <- c(0, 3, 6) #months, what are the actual time frames we should use?
  
  df <- data.frame( 'x' = x, 'y' = y )
  
  #form <- 'y ~ poly(x,2)'
  form <- 'y ~ x' 
  lm <- glm(data=df, formula= form) # what do we expect our data to look like? what kind of fitted model should we expect? How do we prevent under/over fitting ? 
  
  plt <- ggplot(data=df, aes(x=x, y=y)) + geom_point() + geom_smooth(method='glm', formula = form)
  print(plt)
  
  # if using a linear model 
  B <- lm$coefficients['x']
  
  # for a second order polynomial model 
  #A = lm$coefficients['poly(x, 2)1']
  #B = lm$coefficients['poly(x, 2)2']
  
  
  C <- lm$coefficients['(Intercept)']
  
  this_AUC <-  18*B + 6*C # 72*A for linear, remove A term
  
  AUC[i] <- this_AUC
  
}

pp_sad <- pp_sad %>% mutate(Cortisol_AUC = AUC)

pp_sad %>% ggplot(aes(x=Cortisol_AUC, y=postpartum_depression)) + geom_point() + geom_smooth(method='glm', method.args=list(family=binomial(link="probit")))

pp_sad %>% ggplot(aes(x=Cortisol_AUC, group=postpartum_depression, fill=as.factor(postpartum_depression), alpha=0.25)) + geom_density()

```
