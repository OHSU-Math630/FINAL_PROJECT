---
title: 'Final Project, P3: EDA'
author: "Nathaniel Evans, ALfonso Poire, Wei-Chun Lin"
date: "November 23, 2018"
output:
  html_document: 
    theme: flatly 
    highlight: kate
    toc: true
    toc_depth: 2
    toc_float : true
    smooth_scroll: true
    #number_sections : true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyr)
library(ggplot2)
library(GGally)

```



## Load Tidy Dataset 

```{r}
getwd()

load('../../data/tidy_data.Rdata')

pp_sad <- df_tidy # rename meaningful 

``` 


# Examine Raw Data 

```{r}
glimpse(pp_sad)

summary(pp_sad)
```


# Visualize 
```{r}
#ggpairs(pp_sad) # takes forever obviously
```


# Let your questions guiiiddddeeeee you






## Future Extension ... (I got bored)
This isn't really EDA, more of extension, but... I wonder if AUC of the cortisol points would be a better predictor of pp depression than just the point values. Would require fitting a curve, calculating the integral.... ORRRR could we use a curve to predict cortisol levels during pp? then use THAT metric to predict depression. 

$$ auc = \int_{0}^{6} (\beta x + C) \space dx \\ ==> 18B + 6C $$
```{r}
AUC <- vector(mode = 'numeric', length=44)
for (i in seq(1,44,1)){ 
  patient <- pp_sad %>% filter(row_number() == i)
  
  y <- c(patient$cortisol_tri1, patient$cortisol_tri2, patient$cortisol_tri3)
  x <- c(0, 3, 6) #months, what are the actual time frames we should use?
  
  df <- data.frame( 'x' = x, 'y' = y )
  
  lm <- glm(data=df, formula= 'y ~ x') # what do we expect our data to look like? what kind of fitted model should we expect? How do we prevent under/over fitting ? 
  
  #plt <- ggplot(data=df, aes(x=x, y=y)) + geom_point() + geom_smooth(method='glm')
  #print(plt)
  
  B <- lm$coefficients['x']
  C <- lm$coefficients['(Intercept)']
  
  this_AUC <- 18*B + 6*C 
  
  AUC[i] <- this_AUC
  
  #print(AUC)
}



pp_sad <- pp_sad %>% mutate(Cortisol_AUC = AUC, postpartum_depression=postpartum_depression)

pp_sad %>% ggplot(aes(x=Cortisol_AUC, y=postpartum_depression)) + geom_point() + geom_smooth(method='glm', method.args=list(family=binomial(link="probit")))

pp_sad %>% ggplot(aes(x=Cortisol_AUC, group=postpartum_depression, color=postpartum_depression)) + geom_density()

```

