---
title: 'Final Project, P3: EDA'
author: "Nathaniel Evans, ALfonso Poire, Wei-Chun Lin"
date: "November 23, 2018"
output:
  html_document: 
    theme: flatly 
    highlight: kate
    toc: true
    toc_depth: 2
    toc_float : true
    smooth_scroll: true
    #number_sections : true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyr)
library(ggplot2)
library(GGally)

```



## Load Tidy Dataset 

```{r}
getwd()

load('../../data/tidy_data.Rdata')

pp_sad <- df_tidy # rename meaningful 

``` 


# Examine Raw Data 

```{r}
glimpse(pp_sad)

summary(pp_sad)
```


# Visualize 
```{r}
#ggpairs(pp_sad) # takes forever obviously
```



#How does depression scores map to postpartum_depression labels? Might there be a better threshold cuttoff?

this section explores the relationships between the various trimesters and the levls of cortosol or the depression index score.


the accuracy of the tables seem to be dependent on the trimester when the test is taken they are more accurate in the third trimester then the first this is to be expected. however the emans do not seem to vary much even in the third trimester so perhaps this is not a very accurate method regardless. trimester 2 seems to be the most infulential predictor. 
```{r}
#variation of depression scores in trimesters seperated by outcome of post partum depression or not 

pp_sad %>% ggplot() + geom_density(aes(x=depression_tri1, fill='tri1', alpha = 0.3)) + geom_density(aes(x=depression_tri2, fill='tri2', alpha = 0.3)) + geom_density(aes(x=depression_tri3, fill='tri3', alpha = 0.3)) + facet_wrap(~postpartum_depression) + ggtitle('trimester depression populations by postpartum outcome') + xlab('depression score')

pp_sad %>% ggplot() + geom_density(aes(x=depression_tri1, group=as.factor(postpartum_depression), fill=postpartum_depression, alpha=0.25))


pp_sad %>% ggplot() + geom_density(aes(x=depression_tri2, group=as.factor(postpartum_depression), fill=as.factor(postpartum_depression), alpha = 0.25))


pp_sad %>% ggplot() + geom_density(aes(x=depression_tri3, group=postpartum_depression, fill=as.factor(postpartum_depression), alpha = 0.25))

```

```{r}
pp_sad %>% ggplot() + geom_violin(aes(x=postpartum_depression,y=depression_tri1,group=postpartum_depression, fill='tri1', alpha=0.3)) + geom_violin(aes(x=postpartum_depression,y=depression_tri2,group=postpartum_depression, fill='tri2', alpha=0.3)) + geom_violin(aes(x=postpartum_depression,y=depression_tri3,group=postpartum_depression, fill='tri3', alpha=0.3))

#same info shown in boxplots
ggplot(pp_sad,aes(x=postpartum_depression,y=depression_tri1,group=postpartum_depression,color=as.factor(postpartum_depression)))+
  geom_boxplot()+
  theme_gray()
ggplot(pp_sad,aes(x=postpartum_depression,y=depression_tri2,group=postpartum_depression,color=as.factor(postpartum_depression)))+
  geom_boxplot()+
  theme_gray()
ggplot(pp_sad,aes(x=postpartum_depression,y=depression_tri3,group=postpartum_depression,color=as.factor(postpartum_depression)))+
  geom_boxplot()+
  theme_gray()
```

```{r}
pp_sad %>% ggplot() + geom_density(aes(x=cortisol_tri1, fill='tri1', alpha = 0.3)) + geom_density(aes(x=cortisol_tri2, fill='tri2', alpha = 0.3)) + geom_density(aes(x=cortisol_tri3, fill='tri3', alpha = 0.3)) + facet_wrap(~postpartum_depression) + ggtitle('trimester cortisol populations by postpartum outcome') + xlab('cortisol level')

pp_sad %>% ggplot() + geom_density(aes(x=cortisol_tri1, group=as.factor(postpartum_depression), fill=postpartum_depression, alpha=0.25))


pp_sad %>% ggplot() + geom_density(aes(x=cortisol_tri2, group=as.factor(postpartum_depression), fill=as.factor(postpartum_depression), alpha = 0.25))


pp_sad %>% ggplot() + geom_density(aes(x=cortisol_tri3, group=postpartum_depression, fill=as.factor(postpartum_depression), alpha = 0.25))

```

```{r}
ggplot(pp_sad,aes(x=postpartum_depression,y=cortisol_tri1,group=postpartum_depression,color=as.factor(postpartum_depression)))+
  geom_boxplot()+
  theme_gray()
ggplot(pp_sad,aes(x=postpartum_depression,y=cortisol_tri2,group=postpartum_depression,color=as.factor(postpartum_depression)))+
  geom_boxplot()+
  theme_gray()
ggplot(pp_sad,aes(x=postpartum_depression,y=cortisol_tri3,group=postpartum_depression,color=as.factor(postpartum_depression)))+
  geom_boxplot()+
  theme_gray()




```

#Relationship between postpartum depression and employment status

This section seemed important as the stress from being emoployed or not seeme like it would have an effect on the cortosol levles of the individual as well as the depression scores related. as such thoughs two paramaters were compaired to employment status

```{r}
ggplot(pp_sad,aes(x=employed,y=cortisol_tri1,group=employed,color=as.factor(employed)))+
  geom_boxplot()+
  theme_gray()
ggplot(pp_sad,aes(x=employed,y=cortisol_tri2,group=employed,color=as.factor(employed)))+
  geom_boxplot()+
  theme_gray()
ggplot(pp_sad,aes(x=employed,y=cortisol_tri3,group=employed,color=as.factor(employed)))+
  geom_boxplot()+
  theme_gray()
```
```{r}
ggplot(pp_sad,aes(x=employed,y=depression_tri1,group=employed,color=as.factor(employed)))+
  geom_boxplot()+
  theme_gray()
ggplot(pp_sad,aes(x=employed,y=depression_tri2,group=employed,color=as.factor(employed)))+
  geom_boxplot()+
  theme_gray()
ggplot(pp_sad,aes(x=employed,y=depression_tri3,group=employed,color=as.factor(employed)))+
  geom_boxplot()+
  theme_gray()
```

#Relationship between job type and depression score and cortosol levels

we also investigated the relationship between job type and cortosol and depression scores as we thought that this two would affect the results.
there does seem to be some correlation here between having a job and depression score but not so much cortosol levels.

```{r}
ggplot(pp_sad,aes(x=occupation,y=depression_tri1,group=occupation,color=as.factor(occupation)))+
  geom_boxplot()+
  theme_gray()
ggplot(pp_sad,aes(x=occupation,y=depression_tri2,group=occupation,color=as.factor(occupation)))+
  geom_boxplot()+
  theme_gray()
ggplot(pp_sad,aes(x=occupation,y=depression_tri3,group=occupation,color=as.factor(occupation)))+
  geom_boxplot()+
  theme_gray()
```
```{r}
ggplot(pp_sad,aes(x=occupation,y=cortisol_tri1,group=occupation,color=as.factor(occupation)))+
  geom_boxplot()+
  theme_gray()
ggplot(pp_sad,aes(x=occupation,y=cortisol_tri2,group=occupation,color=as.factor(occupation)))+
  geom_boxplot()+
  theme_gray()
ggplot(pp_sad,aes(x=occupation,y=cortisol_tri3,group=occupation,color=as.factor(occupation)))+
  geom_boxplot()+
  theme_gray()
```

#Occupation vs Postpartum depression and Employment vs Postpartum depression

while employment type dosent seem to have to much of an effect on postpartum depression it would seem that being unemployed does 

```{r}
ggplot(pp_sad,aes(x=occupation,y=postpartum_depression,fill=as.factor(postpartum_depression)))+
  geom_col()+
  theme_gray()
ggplot(pp_sad,aes(x=employed,y=postpartum_depression,fill=as.factor(postpartum_depression)))+
  geom_col()+
  theme_gray()
```


#Wanted vs Unwanted  and first pregnancy

this seemed to have remarkably little affect
```{r}
ggplot(pp_sad,aes(x=wanted_pregnancy,y=postpartum_depression,fill=as.factor(postpartum_depression)))+
  geom_col()+
  theme_gray()
ggplot(pp_sad,aes(x=first_pregnancy,y=postpartum_depression,fill=as.factor(postpartum_depression)))+
  geom_col()+
  theme_gray()
```
#Sex of fetus vs depression

```{r}
ggplot(pp_sad,aes(x=fetus_sex,y=postpartum_depression,fill=as.factor(postpartum_depression)))+
  geom_col()+
  theme_gray()


```

#Cortosol and depression relation across trimesters

this was intresting because it switches to a negitive correlation in the last semester
```{r}
ggplot(pp_sad,aes(x=depression_tri1,y=cortisol_tri1,color=postpartum_depression))+geom_point()+geom_smooth(method = "lm", se = FALSE)
ggplot(pp_sad,aes(x=depression_tri2,y=cortisol_tri2,color=postpartum_depression))+geom_point()+geom_smooth(method = "lm", se = FALSE)
ggplot(pp_sad,aes(x=depression_tri3,y=cortisol_tri3,color=postpartum_depression))+geom_point()+geom_smooth(method = "lm", se = FALSE)
```

#Colinearlity between variables? what do we want to avoid including in our model?

```{r}
# we should really only check continuous variables 

.cor <- pp_sad %>% select(starts_with('cortisol'), starts_with('depression'), age, epds, education_level, fetus_sex, previous_miscarriage) %>% cor()
library(reshape2)
melted_sad <- melt(.cor)

ggplot(data = melted_sad, aes(x=Var1, y=Var2, fill=value)) + geom_tile() +  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
   name="Pearson\nCorrelation") +  theme(axis.text.x = element_text(angle = 60, vjust = 1, 
    size = 12, hjust = 1))
```

